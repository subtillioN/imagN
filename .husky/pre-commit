#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}ðŸ”„ Running TTSD pre-commit cycle...${NC}"

# Run TTSD pre-commit checks
npm run ttsd:pre-commit || {
  echo "${RED}âœ˜ TTSD pre-commit checks failed${NC}"
  exit 1
}

echo "${GREEN}âœ“ TTSD pre-commit checks passed${NC}"

# Run bundle analysis in background
npm run analyze-bundle &

# Check for dev-tools files in wrong location
INVALID_FILES=$(git diff --cached --name-only | grep -E "dev-tools|devtools" | grep -v "^FRAOP-MVI-Dev-Tools/")

if [ ! -z "$INVALID_FILES" ]; then
  echo "${RED}ERROR: Dev tools files found outside FRAOP-MVI-Dev-Tools module${NC}"
  echo "The following files violate the architectural rules:"
  echo "$INVALID_FILES"
  echo "\nDev tools code MUST be in the FRAOP-MVI-Dev-Tools module."
  echo "This is a strict separation of concerns rule."
  exit 1
fi

# Run TypeScript validation
npm run typecheck || exit 1

# Run module boundary validation
node scripts/validate-module-boundaries.js || exit 1

echo "${GREEN}âœ“ Module boundary validation passed${NC}"

# Run ESLint
npm run lint

# Run Prettier
npm run format

# Run tests
npm run test 